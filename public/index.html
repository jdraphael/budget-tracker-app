<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker</title>
    <!-- CDN Links -->
    <link rel="stylesheet" href="../assets/styles.css">
    <link rel="stylesheet" href="../assets/bills.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/luxon/3.3.0/luxon.min.js"></script>
    <script type="module" src="../src/app.js"></script>
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="app-title">
            <i class="icon">üí∞</i>
            <span>Budget Tracker</span>
        </div>
        <div class="search-bar">
            <i class="icon">üîç</i>
            <input type="text" id="global-search" placeholder="Search across all data...">
        </div>
        <div class="month-picker">
            <label for="month-select">Viewing:</label>
            <input type="month" id="month-select" value="2025-09">
        </div>
        <div class="header-actions">
            <button id="undo-btn" class="btn btn-sm btn-outline" title="Undo last action">
                <i class="icon">‚Ü©Ô∏è</i> Undo
            </button>
            <button id="sync-btn" class="btn btn-sm">
                <i class="icon">üîÑ</i> Rebuild Month
            </button>
        </div>
    </header>
    <!-- Tab Navigation -->
    <nav class="tabs" role="tablist" aria-label="Primary">
        <div class="tab active" role="tab" tabindex="0" aria-selected="true" data-tab="dashboard">Dashboard</div>
        <div class="tab" role="tab" tabindex="0" aria-selected="false" data-tab="bills">Bills</div>
        <div class="tab" role="tab" tabindex="0" aria-selected="false" data-tab="income">Income</div>
        <div class="tab" role="tab" tabindex="0" aria-selected="false" data-tab="transactions">Transactions</div>
        <div class="tab" role="tab" tabindex="0" aria-selected="false" data-tab="budgets">Budgets</div>
        <div class="tab" role="tab" tabindex="0" aria-selected="false" data-tab="categories">Categories</div>
        <div class="tab" role="tab" tabindex="0" aria-selected="false" data-tab="settings">Settings</div>
    </nav>
    <!-- Main Content -->
    <main>
        <!-- Dashboard Tab -->
        <section id="dashboard" class="tab-content active">
            <div class="kpi-container">
                <div class="kpi-card">
                    <div class="kpi-title">Total Income</div>
                    <div class="kpi-value positive-value">$5,420.00</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">Total Expenses</div>
                    <div class="kpi-value negative-value">$3,980.50</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">Net Amount</div>
                    <div class="kpi-value positive-value">$1,439.50</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">Budget Utilization</div>
                    <div class="kpi-value">73%</div>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-card">
                    <h3>Income vs Expenses</h3>
                    <canvas id="income-expense-chart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Spending by Category</h3>
                    <canvas id="spending-chart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Budget vs Actual</h3>
                    <canvas id="budget-actual-chart"></canvas>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Recent Transactions</h2>
                    <button class="btn btn-sm">View All</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2025-08-15</td>
                                <td>Electricity Bill</td>
                                <td>Utilities</td>
                                <td class="negative-value">$185.00</td>
                                <td><span class="badge badge-active">Paid</span></td>
                            </tr>
                            <tr class="overdue">
                                <td>2025-08-10</td>
                                <td>Internet Subscription</td>
                                <td>Utilities</td>
                                <td class="negative-value">$79.99</td>
                                <td><span class="badge badge-overdue">Overdue</span></td>
                            </tr>
                            <tr>
                                <td>2025-08-05</td>
                                <td>Salary Deposit</td>
                                <td>Income</td>
                                <td class="positive-value">$3,200.00</td>
                                <td><span class="badge badge-active">Received</span></td>
                            </tr>
                            <tr>
                                <td>2025-08-03</td>
                                <td>Grocery Shopping</td>
                                <td>Food</td>
                                <td class="negative-value">$147.30</td>
                                <td><span class="badge badge-active">Paid</span></td>
                            </tr>
                            <tr>
                                <td>2025-08-01</td>
                                <td>Rent Payment</td>
                                <td>Housing</td>
                                <td class="negative-value">$1,200.00</td>
                                <td><span class="badge badge-active">Paid</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        <!-- Other Tabs (simplified for this example) -->
        <section id="bills" class="tab-content">
            <div class="action-bar">
                <h2>Bills Management</h2>
                <button class="btn" id="open-add-bill-modal">+ Add New Bill</button>
            </div>
            <!-- Removed card placeholder as it interferes with dynamic table generation -->
        </section>
        <section id="income" class="tab-content">
            <div class="action-bar">
                <h2>Income Sources</h2>
                <button class="btn">+ Add Income Source</button>
            </div>
            <div class="card">
                <p>Income management interface would be here with full CRUD operations.</p>
            </div>
        </section>
        <section id="transactions" class="tab-content">
            <div class="action-bar">
                <h2>All Transactions</h2>
                <div class="btn-group">
                    <button class="btn">+ Add Transaction</button>
                    <button class="btn btn-outline">Filter</button>
                </div>
            </div>
            <div class="card">
                <p>Transactions management interface would be here with full CRUD operations.</p>
            </div>
        </section>
        <section id="budgets" class="tab-content">
            <div class="action-bar">
                <h2>Budget Planning</h2>
                <button class="btn">+ Create Budget</button>
            </div>
            <div class="card">
                <p>Budget management interface would be here with full CRUD operations.</p>
            </div>
        </section>
        <section id="categories" class="tab-content">
            <div class="action-bar">
                <h2>Categories & Subcategories</h2>
                <button class="btn">+ Add Category</button>
            </div>
            <div class="card">
                <p>Category management interface would be here with full CRUD operations.</p>
            </div>
        </section>
        <!-- Settings Tab -->
        <section id="settings" class="tab-content">
            <div class="card">
                <h2 class="card-title">Settings & Backup</h2>
                <div class="settings-grid">
                    <div class="settings-panel">
                        <h3>Data Management</h3>
                        <div class="form-group">
                            <button class="btn" id="select-folder-btn">Select Data Folder</button>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-outline" id="import-btn">Import CSV Files</button>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-outline" id="export-btn">Export CSV Files</button>
                        </div>
                        <div class="form-group">
                            <button class="btn" id="backup-btn">Create Backup ZIP</button>
                        </div>
                    </div>
                    <div class="settings-panel">
                        <h3>Recurrence Settings</h3>
                        <div class="form-group">
                            <label>Auto-materialize on load</label>
                            <select>
                                <option selected>Enabled</option>
                                <option>Disabled</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Default Recurrence Rule</label>
                            <select>
                                <option>Monthly</option>
                                <option>Weekly</option>
                                <option selected>Biweekly</option>
                                <option>Annually</option>
                                <option>Custom</option>
                            </select>
                        </div>
                    </div>
                    <div class="settings-panel">
                        <h3>Appearance</h3>
                        <div class="form-group">
                            <label>Theme</label>
                            <select>
                                <option selected>Dark Theme</option>
                                <option>Light Theme</option>
                                <option>System Default</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Currency Format</label>
                            <select>
                                <option selected>US Dollars ($)</option>
                                <option>Euros (‚Ç¨)</option>
                                <option>British Pounds (¬£)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <h2 class="card-title">How to Use This App</h2>
                <div class="settings-panel">
                    <h3>Getting Started</h3>
                    <p>1. Click "Select Data Folder" to choose where your budget data will be stored</p>
                    <p>2. The app will create the necessary CSV files if they don't exist</p>
                    <p>3. Start adding your bills, income sources, and categories</p>
                    <h3>Recurring Items</h3>
                    <p>‚Ä¢ Set recurrence rules for regular bills and income</p>
                    <p>‚Ä¢ The app will automatically create transactions based on these rules</p>
                    <p>‚Ä¢ Use "Rebuild Month" to regenerate transactions for the current month</p>
                    <h3>Backup</h3>
                    <p>‚Ä¢ Regularly create backups using the "Create Backup ZIP" button</p>
                    <p>‚Ä¢ Backups include all your CSV data files</p>
                </div>
            </div>
        </section>
    </main>
    <!-- Export Banner -->
    <div id="export-banner" class="export-banner hidden">
        <div>
            <strong>Remember to Export Your Data!</strong> 
            <span>Your changes are not saved to CSV files yet.</span>
        </div>
        <button class="btn btn-sm">Export Now</button>
    </div>
    <!-- Footer -->
    <footer>
        Budget Tracker App ‚Ä¢ All data stored locally ‚Ä¢ No tracking or analytics
    </footer>
    
    <!-- Inline CSV fallbacks for offline/file:// usage -->
    <script type="text/csv" id="seed-bills-csv">id,name,amount,recurrence,start_date,end_date,status
1,Rent,1200.00,Monthly,2025-01-01,,Active
2,Electricity,150.00,Monthly,2025-01-01,,Active
3,Internet,80.00,Monthly,2025-01-01,,Active
4,Water,50.00,Monthly,2025-01-01,,Active
5,Car Insurance,120.00,Monthly,2025-01-01,,Active
6,Gas,60.00,Monthly,2025-01-01,,Active
7,Groceries,400.00,Monthly,2025-01-01,,Active
8,Phone,70.00,Monthly,2025-01-01,,Active
9,Credit Card,200.00,Monthly,2025-01-01,,Active
10,Netflix,15.99,Monthly,2025-01-01,,Active</script>

    <script type="text/csv" id="seed-income-csv">id,source,amount,date,recurrence,status
1,Salary,3500.00,2025-01-01,Monthly,Received
2,Freelance,500.00,2025-01-15,Monthly,Received
3,Investment Dividends,200.00,2025-01-01,Monthly,Received
4,Bonus,1000.00,2025-06-01,Annually,Received
5,Salary,3600.00,2025-09-01,Monthly,Received
6,Freelance,650.00,2025-09-15,Monthly,Pending</script>

    <script type="text/csv" id="seed-transactions-csv">id,date,description,category,amount,status
1,2025-08-01,Rent Payment,Housing,-1200.00,Paid
2,2025-08-01,Electricity Bill,Utilities,-150.00,Paid
3,2025-08-01,Internet Bill,Utilities,-80.00,Paid
4,2025-08-01,Water Bill,Utilities,-50.00,Paid
5,2025-08-01,Car Insurance,Transportation,-120.00,Paid
6,2025-08-01,Gas Bill,Utilities,-60.00,Paid
7,2025-08-01,Groceries,Food,-400.00,Paid
8,2025-08-01,Phone Bill,Utilities,-70.00,Paid
9,2025-08-01,Credit Card Payment,Debt,-200.00,Paid
10,2025-08-01,Netflix Subscription,Personal,-15.99,Paid
11,2025-08-01,Salary Deposit,Income,3500.00,Received
12,2025-08-15,Freelance Payment,Income,500.00,Received
13,2025-08-01,Investment Dividends,Income,200.00,Received
14,2025-08-05,Grocery Shopping,Food,-150.00,Paid
15,2025-08-10,Dining Out,Food,-75.00,Paid
16,2025-08-12,Gas Fill-up,Transportation,-45.00,Paid
17,2025-08-20,Clothing Purchase,Personal,-120.00,Paid
18,2025-08-25,Coffee Shop,Food,-10.00,Paid
19,2025-09-01,Rent Payment,Housing,-1200.00,Paid
20,2025-09-02,Electricity Bill,Utilities,-155.00,Pending
21,2025-09-03,Internet Bill,Utilities,-80.00,Pending
22,2025-09-05,Salary Deposit,Income,3600.00,Received
23,2025-09-06,Grocery Shopping,Food,-162.40,Paid</script>

    <script type="text/csv" id="seed-categories-csv">id,category,subcategory
1,Housing,Rent/Mortgage
2,Housing,HOA
3,Housing,Repairs
4,Utilities,Electric
5,Utilities,Water
6,Utilities,Gas
7,Utilities,Trash
8,Utilities,Internet
9,Utilities,Mobile
10,Transportation,Fuel
11,Transportation,Maintenance
12,Transportation,Insurance
13,Transportation,Parking/Transit
14,Food,Groceries
15,Food,Dining Out
16,Food,Coffee
17,Health,Insurance
18,Health,Copay
19,Health,Pharmacy
20,Personal,Clothing
21,Personal,Hair/Beauty
22,Personal,Subscriptions
23,Kids/Family,Childcare
24,Kids/Family,School
25,Kids/Family,Activities
26,Debt,Credit Card
27,Debt,Student Loan
28,Debt,Personal Loan
29,Savings,Emergency Fund
30,Savings,Retirement
31,Savings,General
32,Income,Salary
33,Income,Bonus
34,Income,Reimbursement
35,Income,Other</script>

    <script type="text/csv" id="seed-budgets-csv">id,name,amount,period,utilization
1,Housing,1300.00,Monthly,92
2,Utilities,260.00,Monthly,78
3,Transportation,200.00,Monthly,82
4,Food,600.00,Monthly,83
5,Personal,300.00,Monthly,48
6,Debt,250.00,Monthly,80</script>
    <!-- Modal for Adding New Bill -->
    <div id="add-bill-modal" class="card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:999; min-width:340px; max-width:90vw; box-shadow:0 8px 32px rgba(0,0,0,0.25);">
        <h2 class="card-title">Add New Bill</h2>
        <form id="add-bill-form">
            <div class="form-group">
                <label for="bill-name">Name</label>
                <input type="text" id="bill-name" required>
            </div>
            <div class="form-group">
                <label for="bill-amount">Amount</label>
                <input type="number" id="bill-amount" required min="0" step="0.01">
            </div>
            <div class="form-group">
                <label for="bill-recurrence">Recurrence</label>
                <select id="bill-recurrence">
                    <option value="Monthly">Monthly</option>
                    <option value="Weekly">Weekly</option>
                    <option value="Biweekly">Biweekly</option>
                    <option value="Annually">Annually</option>
                    <option value="Custom">Custom</option>
                </select>
            </div>
            <div class="form-group">
                <label for="bill-start">Start Date</label>
                <input type="date" id="bill-start" required>
            </div>
            <div class="form-group">
                <label for="bill-end">End Date</label>
                <input type="date" id="bill-end">
            </div>
            <div class="form-group">
                <label for="bill-status">Status</label>
                <select id="bill-status">
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                </select>
            </div>
            <div class="btn-group">
                <button type="submit" class="btn">Add Bill</button>
                <button type="button" class="btn btn-outline" id="cancel-add-bill">Cancel</button>
            </div>
        </form>
    </div>
    <!-- Modal for Adding/Editing Income -->
    <div id="add-income-modal" class="card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:999; min-width:340px; max-width:90vw; box-shadow:0 8px 32px rgba(0,0,0,0.25);">
        <h2 class="card-title">Add/Edit Income</h2>
        <form id="add-income-form">
            <div class="form-group">
                <label for="income-source">Source</label>
                <input type="text" id="income-source" required>
            </div>
            <div class="form-group">
                <label for="income-amount">Amount</label>
                <input type="number" id="income-amount" required min="0" step="0.01">
            </div>
            <div class="form-group">
                <label for="income-date">Date</label>
                <input type="date" id="income-date" required>
            </div>
            <div class="form-group">
                <label for="income-recurrence">Recurrence</label>
                <select id="income-recurrence">
                    <option value="Monthly">Monthly</option>
                    <option value="Weekly">Weekly</option>
                    <option value="Biweekly">Biweekly</option>
                    <option value="Annually">Annually</option>
                    <option value="Custom">Custom</option>
                </select>
            </div>
            <div class="form-group">
                <label for="income-status">Status</label>
                <select id="income-status">
                    <option value="Received">Received</option>
                    <option value="Pending">Pending</option>
                </select>
            </div>
            <div class="btn-group">
                <button type="submit" class="btn">Save</button>
                <button type="button" class="btn btn-outline" id="cancel-add-income">Cancel</button>
            </div>
        </form>
    </div>
    <!-- Modal for Adding/Editing Transaction -->
    <div id="add-transaction-modal" class="card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:999; min-width:340px; max-width:90vw; box-shadow:0 8px 32px rgba(0,0,0,0.25);">
        <h2 class="card-title">Add/Edit Transaction</h2>
        <form id="add-transaction-form">
            <div class="form-group">
                <label for="transaction-date">Date</label>
                <input type="date" id="transaction-date" required>
            </div>
            <div class="form-group">
                <label for="transaction-description">Description</label>
                <input type="text" id="transaction-description" required>
            </div>
            <div class="form-group">
                <label for="transaction-category">Category</label>
                <input type="text" id="transaction-category" required>
            </div>
            <div class="form-group">
                <label for="transaction-amount">Amount</label>
                <input type="number" id="transaction-amount" required min="0" step="0.01">
            </div>
            <div class="form-group">
                <label for="transaction-status">Status</label>
                <select id="transaction-status">
                    <option value="Paid">Paid</option>
                    <option value="Overdue">Overdue</option>
                    <option value="Received">Received</option>
                </select>
            </div>
            <div class="btn-group">
                <button type="submit" class="btn">Save</button>
                <button type="button" class="btn btn-outline" id="cancel-add-transaction">Cancel</button>
            </div>
        </form>
    </div>
    <!-- Modal for Adding/Editing Budget -->
    <div id="add-budget-modal" class="card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:999; min-width:340px; max-width:90vw; box-shadow:0 8px 32px rgba(0,0,0,0.25);">
        <h2 class="card-title">Add/Edit Budget</h2>
        <form id="add-budget-form">
            <div class="form-group">
                <label for="budget-name">Name</label>
                <input type="text" id="budget-name" required>
            </div>
            <div class="form-group">
                <label for="budget-amount">Amount</label>
                <input type="number" id="budget-amount" required min="0" step="0.01">
            </div>
            <div class="form-group">
                <label for="budget-period">Period</label>
                <input type="text" id="budget-period" required>
            </div>
            <div class="form-group">
                <label for="budget-utilization">Utilization</label>
                <input type="number" id="budget-utilization" min="0" max="100" step="1">
            </div>
            <div class="btn-group">
                <button type="submit" class="btn">Save</button>
                <button type="button" class="btn btn-outline" id="cancel-add-budget">Cancel</button>
            </div>
        </form>
    </div>
    <!-- Modal for Adding/Editing Category -->
    <div id="add-category-modal" class="card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:999; min-width:340px; max-width:90vw; box-shadow:0 8px 32px rgba(0,0,0,0.25);">
        <h2 class="card-title">Add/Edit Category</h2>
        <form id="add-category-form">
            <div class="form-group">
                <label for="category-name">Category</label>
                <input type="text" id="category-name" required>
            </div>
            <div class="form-group">
                <label for="subcategory-name">Subcategory</label>
                <input type="text" id="subcategory-name">
            </div>
            <div class="btn-group">
                <button type="submit" class="btn">Save</button>
                <button type="button" class="btn btn-outline" id="cancel-add-category">Cancel</button>
            </div>
        </form>
    </div>
<script>
// Fallback tab wiring in case module initialization fails
(function(){
    function doSwitch(tabId){
        if (window.switchTab) { window.switchTab(tabId); return; }
        // Minimal inline fallback
        document.querySelectorAll('.tab').forEach(t => {
            const isActive = t.getAttribute('data-tab') === tabId;
            t.classList.toggle('active', isActive);
            if (isActive) { t.setAttribute('aria-selected','true'); } else { t.setAttribute('aria-selected','false'); }
        });
        document.querySelectorAll('.tab-content').forEach(c => {
            c.classList.toggle('active', c.id === tabId);
        });
    }
    function handleActivate(el){ const id = el && el.getAttribute('data-tab'); if (id) doSwitch(id); }
    const tabs = document.querySelector('.tabs');
    if (tabs) {
        tabs.addEventListener('click', (e)=>{
            const el = e.target.closest('.tab');
            if (el && tabs.contains(el)) { e.preventDefault(); handleActivate(el); }
        });
        tabs.addEventListener('keydown', (e)=>{
            const el = e.target.closest('.tab');
            if (!el) return;
            if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handleActivate(el); }
        });
    }
})();
// Ensure month input reflects app state when modules load successfully
document.addEventListener('DOMContentLoaded', function(){
    try {
        if (window.luxon) {
            const ym = luxon.DateTime.now().toFormat('yyyy-MM');
            const inp = document.getElementById('month-select');
            if (inp && (!inp.value || !/^\d{4}-\d{2}$/.test(inp.value))) inp.value = ym;
        }
    } catch {}
});
</script>
</body>
</html>
